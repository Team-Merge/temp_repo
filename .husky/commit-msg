#!/usr/bin/env sh

# ì»¤ë°‹ ë©”ì‹œì§€ë¥¼ ì €ì¥í•œ íŒŒì¼ì„ ë³€ìˆ˜ì— ì €ì¥
message="$(cat "$1")"

# ì •ê·œ í‘œí˜„ì‹ì„ ì‚¬ìš©í•˜ì—¬ ë©”ì‹œì§€ ê²€ì‚¬
# Header: íƒ€ì…(ìŠ¤ì½”í”„): ì£¼ì œ
headerPattern="^(feat|fix|build|chore|ci|docs|style|refactor|test|perf)(\([^\)]+\))?:\s?.{0,50}$"
# Body: ìƒì„¸ ì„¤ëª… (ì„ íƒì )
bodyPattern="^(|\s.{1,})$"
# Footer: ì°¸ì¡° ì •ë³´ (ì„ íƒì )
footerPattern="^(|\sIssues #[0-9]+)$"

# ë©”ì‹œì§€ë¥¼ ë¹ˆ í–‰ìœ¼ë¡œ ë‚˜ëˆ„ê¸°
IFS="\n\n" read -r header body footer <<EOF
$message
EOF

# Header ê²€ì¦
if ! [[ $header =~ $headerPattern ]]; then
  echo "=========================================================================="
  echo "======================   ğŸš¨ WRONG COMMIT MESSAGE!   ======================"
  echo "=========================================================================="
  echo "== Header Format should be => íƒ€ì…(ìŠ¤ì½”í”„): ì£¼ì œ                       =="
  echo "== Allowed Types: feat, fix, build, chore, ci, docs, style, refactor, test, perf =="
  echo "== EXAMPLE => feat: ë¡œê·¸ì¸ ê¸°ëŠ¥ ì¶”ê°€                                   =="
  echo "==            feat(auth): ì‚¬ìš©ì ì¸ì¦ ê¸°ëŠ¥ ì¶”ê°€                        =="
  echo "=========================================================================="
  exit 1
fi

# Body ê²€ì¦ (ìƒëµ ê°€ëŠ¥í•˜ì§€ë§Œ ìˆë‹¤ë©´ ì¡°ê±´ ë§Œì¡±í•´ì•¼ í•¨)
if [ -n "$body" ] && ! [[ $body =~ $bodyPattern ]]; then
  echo "=========================================================================="
  echo "======================   ğŸš¨ WRONG BODY FORMAT!    ========================"
  echo "=========================================================================="
  echo "== Body should provide detailed information (optional)                 =="
  echo "=========================================================================="
  exit 1
fi

# Footer ê²€ì¦ (ìƒëµ ê°€ëŠ¥í•˜ì§€ë§Œ ìˆë‹¤ë©´ ì¡°ê±´ ë§Œì¡±í•´ì•¼ í•¨)
if [ -n "$footer" ] && ! [[ $footer =~ $footerPattern ]]; then
  echo "=========================================================================="
  echo "======================   ğŸš¨ WRONG FOOTER FORMAT!  ========================"
  echo "=========================================================================="
  echo "== Footer should reference issues in the format: Issues #1234          =="
  echo "=========================================================================="
  exit 1
fi

# ì„±ê³µ ë©”ì‹œì§€ ì¶œë ¥
echo "=========================================================================="
echo "=======================      COMMIT CREATED!!      ======================="
echo "=========================================================================="
